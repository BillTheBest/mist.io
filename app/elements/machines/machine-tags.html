<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../app-rules/app-rules.html">
<link rel="import" href="machine-edit.html">
<dom-module id="machine-tags">
    <template>
        <style is="custom-style" include="tags-and-labels"></style>
        <style is="custom-style" include="info-table-style"></style>
        <style is="custom-style" include="single-page"></style>
        <style include="shared-styles">
            :host {
                display: block;
                background: #fafafa;
            }

            #content {
                overflow: auto;
                -webkit-overflow-scrolling: touch;
                padding: 20px;
            }

            .flex-horizontal-with-ratios {
                @apply(--layout-horizontal);
                align-content: stretch;
                flex: 100%;
            }

            .flexchild {
                @apply(--layout-flex);
            }

            .paper-header h2 {
                @apply(--layout-flex-none);
            }

            .machine-ip {
                margin: 0;
            }

            paper-material {
                padding-bottom: 0;
            }

            paper-material > h2 {
                line-height: initial !important;
                margin-bottom: 0;
                cursor: pointer;
            }

            .subhead {
                box-sizing: border-box;
                position: absolute;
                width: 100%;
                left: 0;
                height: 57px;
                bottom: -57px;
                right: 0;
                z-index: 9;
                color: rgba(0, 0, 0, 0.87);
            }

            .content {
                margin-top: 57px;
            }

            paper-header-panel::content #dropShadow {
                top: 56px;
            }

            paper-toolbar::content #bottomBar .right-actions {
                transition: var(--paper-toolbar-transition, margin-right 0.18s ease-in);
            }

            paper-toolbar:not(.tall)::content #bottomBar .right-actions {
                margin-right: 70px;
            }

            .label {
                padding: 2px !important;
            }
        </style>
        <paper-drawer-panel id="drawerPanel" responsive-width="900px" narrow="{{narrowMode}}" drawer-width="272px" disable-edge-swipe>
            <app-sidebar tag="[[tag]]" sections="[[sections]]" current="machines" drawer></app-sidebar>
            <paper-header-panel id="container" mode="waterfall-tall" main>
                <paper-toolbar class="tall" style$="[[_getHeaderStyle(section.color)]]">
                    <paper-icon-button icon="icons:arrow-back" on-tap="_goBack"></paper-icon-button>
                    <span class="title"></span>
                    <app-user-menu email="[[model.email]]"></app-user-menu>
                    <span class="bottom title">Machine: [[machine.name]]</span>
                    <span class="bottom right-actions">
                        <template is="dom-if" if="[[machine.can_rename]]">
                            <paper-tooltip for="editMachine" position="top">Rename Machine</paper-tooltip>
                            <paper-icon-button id="editMachine" icon="icons:create" on-tap="_editMachine"></paper-icon-button>
                        </template>
                        <template is="dom-if" if="[[machine.can_destroy]]">
                            <paper-tooltip for="deleteTemplate" position="top">Delete Machine</paper-tooltip>
                            <paper-icon-button id="deleteTemplate" icon="icons:delete" on-tap="_deleteTemplate"></paper-icon-button>
                        </template>
                    </span>
                    <div class="subhead bottom">
                        <div class="label">
                            <span class$="[[machine.state]]" title="machine state">[[machine.state]]</span>
                        </div>
                        <div class="fab-top-right">
                            <paper-fab icon="av:play-arrow" on-tap="_toggleQuickActions" id="runTemplateFab"></paper-fab>
                        </div>
                    </div>
                </paper-toolbar>
                <div class="content">
                    <div class="page">
                        <paper-material class="info-card">
                            <h2>Tags</h2>
                            <div class="card-content">
                                <table class="info-table">
                                    <template is="dom-repeat" items="[[machine.tags]]" as="tag">
                                        <tr>
                                            <td>
                                                <paper-input value="{{tag.key}}"></paper-input>
                                            </td>
                                            <td>
                                                <paper-input value="{{tag.value}}"></paper-input>
                                            </td>
                                        </tr>
                                    </template>
                                </table>
                            </div>
                        </paper-material>
                    </div>
                </div>
                <div class="absolute-bottom-right">
                    <app-fab></app-fab>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
        <dialog-element></dialog-element>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'machine-tags',

        properties: {
            model: {
                type: Object,
                notify: true
            },
            router: Object,
            params: {
                type: Object,
                notify: true
            },
            machine: {
                type: Object,
                computed: '_computeMachine(params, model.machinesArray.*)'
            },
            sections: {
                type: Array,
                notify: true
            },
            section: {
                type: Object
            },
            tag: {
                type: String,
                value: ""
            }
        },
        _computeMachine: function(params, machines) {
            return machines.base.find(function(machine) {
                return machine.uuid == params.uuid;
            }, this);
        },
        _getHeaderStyle: function(color) {
            return 'background-color: ' + color + '; color: #fff;';
        },
        _goBack: function() {
            history.back();
        }
    });
</script>
