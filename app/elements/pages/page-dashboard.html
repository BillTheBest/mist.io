<link rel="import" href="../../bower_components/google-chart/google-chart.html">
<link rel="import" href="../section-tile/section-tile.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../app-incidents/app-incidents.html">
<link rel="import" href="../app-forms/app-forms.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<dom-module id="page-dashboard">
    <template>
        <style is="custom-style" include="headings"></style>
        <style>
        :host {
            --layout-margin: 0.5em;
        }
        
        paper-header-panel {
            background: rgb(245, 245, 245);
        }
        
        paper-header-panel {
            --paper-header-panel-shadow: {
                height: 6px;
                bottom: -6px;
                box-shadow: inset 0 2px 2px 0 rgba(0, 0, 0, 0.14), inset 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
        }
        /* layout helper classes */
        
        .content {
            display: block;
            padding: 50px 0;
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .flex-horizontal-with-ratios {
            @apply(--layout-horizontal);
            justify-content: stretch;
        }
        
        .flexchild {
            @apply(--layout-flex);
        }
        
        .flex2child {
            @apply(--layout-flex-2);
            order: 2;
        }
        
        .flex3child {
            @apply(--layout-flex-2);
            order: 1;
        }
        
        .pad {
            padding: 8px;
        }
        /* header */
        
        paper-toolbar {
            background-color: #fff;
        }
        
        .search.active {
            left: 15px;
        }
        /* clouds */
        
        .clouds {
            display: inline-block;
            overflow: hidden;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #eee;
            margin: var(--layout-margin);
        }
        
        .clouds span.cloud-title {
            bottom: -2px;
            position: relative;
        }
        
        .clouds paper-button {
            background-color: #fff;
            color: inherit;
            border-left: 4px solid #757575;
            
        }

        paper-button ::content iron-icon {
            border-radius: 2em;
            background-color: #eee;
            padding: 3px;
        }

        paper-button ::content iron-icon[icon='check'] {
            color: green;
        }

        paper-button ::content iron-icon[icon='clear'] {
            color: #fff;
            background-color: #D96557;
        }

        /* sections */
        
        .sections {
            align-items: stretch;
        }
        
        a.main-section {
            min-width: 200px;
            margin: var(--layout-margin);
        }
        /* incidents */
        
        .incidents {
            margin: var(--layout-margin);
            @apply(--layout-horizontal);
            align-items: stretch;
        }
        /* graphs */
        
        .graphs {
            margin: var(--layout-margin);
        }
        
        google-chart {
            height: 300px;
            width: 100%;
        }
        
        @media (max-width: 489px) {
            a.main-section {
                width: calc(100% - 1em);
            }
        }
        
        @media (max-width: 639px) {
            paper-toolbar /deep/ #topBar {
                margin-top: 4px;
                padding: 0 16px;
            }
            a.main-section:first-child {
                min-width: calc(100% - 1em);
            }
        }
        
        @media (max-width: 639px) {
            .flex-horizontal-with-ratios {
                @apply(--layout-vertical);
            }
            .flex2child {
                order: 1;
            }
            .flex3child {
                order: 2;
            }
        }
        </style>
        <paper-header-panel mode="standard" class="fit">
            <paper-toolbar class="paper-header">
                <app-logo full class="flex"></app-logo>
                <app-bar class="horizontal layout center end-justified" no-search></app-bar>
                <app-user-menu email="marios@mist.io"></app-user-menu>
            </paper-toolbar>
            <div class="content">
                <div class="clouds">
                    <template is="dom-repeat" items="{{model.cloudsArray}}">
                        <paper-button raised class="link">
                            <template is="dom-if" if="{{isOnline(item)}}">
                                <iron-icon icon="check"></iron-icon>
                            </template>
                            <template is="dom-if" if="{{isOffline(item)}}">
                                <iron-icon icon="clear"></iron-icon>
                            </template>
                            <span class="cloud-title">{{item.title}}</span>
                        </paper-button>
                    </template>
                    <paper-button raised><a href="/elements">elements</a></paper-button>
                    <div class="absolute-bottom-right">
                        <paper-menu-button vertical-align="bottom" horizontal-align="right">
                            <paper-fab icon="add" class="dropdown-trigger" alt="bottom align">Actions</paper-fab>
                            <paper-menu class="dropdown-content">
                                <paper-button>Add Machine</paper-button>
                                <paper-button>Add Cloud</paper-button>
                                <paper-button>Add Key</paper-button>
                                <paper-button>Add Script</paper-button>
                            </paper-menu>
                        </paper-menu-button>
                    </div>
                </div>
                <div class="container flex-horizontal-with-ratios">
                    <app-incidents id="right" class="flex2child incidents top right"></app-incidents>
                    <div id="left" class="flex3child top left">
                        <div class="sections layout horizontal wrap">
                            <a href="/machines" class="main-section flex" is="pushstate-anchor">
                                <section-tile name="machines" color="[[sections.machines.color]]" icon="[[sections.machines.icon]]" count="{{model.machinesArray.length}}">
                                </section-tile>
                            </a>
                            <a href="/images" class="main-section flex" is="pushstate-anchor">
                                <section-tile name="images" color="[[sections.images.color]]" icon="[[sections.images.icon]]" count="{{model.imagesArray.length}}"></section-tile>
                            </a>
                            <a href="/keys" class="main-section flex" is="pushstate-anchor">
                                <section-tile name="keys" color="[[sections.keys.color]]" icon="[[sections.keys.icon]]" count="{{model.keysArray.length}}"></section-tile>
                            </a>
                            <a href="/networks" class="main-section flex" is="pushstate-anchor">
                                <section-tile name="networks" color="[[sections.networks.color]]" icon="[[sections.networks.icon]]" count="{{model.networksArray.length}}"></section-tile>
                            </a>
                            <a href="/scripts" class="main-section flex is=" pushstate-anchor "">
                                <section-tile name="scripts" color="[[sections.scripts.color]]" icon="[[sections.scripts.icon]]" count="{{model.scriptsArray.length}}"></section-tile>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="bottom full">
                    <div class="graphs">
                        <paper-material>
                            <h2 class="app-title">Load on all monitored machines</h2>
                            <google-chart id="mutating_gauge" type="line" data='[["Label", "Value"],["Memory", 80],["CPU", 55],["Network", 68]]' options='{
                    "redFrom": 90,
                    "redTo": 100,
                    "yellowFrom": 75,
                    "yellowTo": 90,
                    "minorTicks": 5}'>
                            </google-chart>
                        </paper-material>
                    </div>
                </div>
        </paper-header-panel>
    </template>
</dom-module>
<script>
function getRandomGaugeValue(offset, factor) {
    return offset + Math.round(factor * Math.random());
}

window.setInterval(function() {
    var gauge = document.getElementById('mutating_gauge');
    gauge.data = [
        ["Label", "Value"],
        ["Memory", getRandomGaugeValue(40, 60)],
        ["CPU", getRandomGaugeValue(40, 60)],
        ["Network", getRandomGaugeValue(60, 20)]
    ];

}, 3000);

Polymer({
    is: 'page-dashboard',
    enableCustomStyleProperties: true,
    properties: {
        sections: {
            type: Array
        },
        model: {
            type: Object,
            notify: true
        },
        q: {
            type: String,
            notify: true
        }
    },
    ready: function() {},
    attached: function() {
        // reset page title since this is the default page
        this.fire('page-meta', {
            title: null
        });
    },
    isOnline: function(cloud) {
        return cloud.state == 'online';
    },
    isOffline: function(cloud) {
        return cloud.state == 'offline';
    }
});
</script>
