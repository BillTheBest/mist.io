<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="../section-symbol/section-symbol.html">
<link rel="import" href="../tag-link/tag-link.html">
<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../element-action-menu/element-action-menu.html">
<link rel="import" href="../element-table/element-table.html">
<link rel="import" href="../element-table-cards/element-table-cards.html">
<link rel="import" href="../responsive-element/responsive-element.html">

<link rel="import" href="../app-graph/app-graph.html">
<link rel="import" href="../app-rules/app-rules.html">

<dom-module id="page-machine">
  <link rel="import" type="css" href="page-machine.css">

  <template>
      <app-socket model="{{model}}"></app-socket>
      <paper-drawer-panel id="drawerPanel" responsive-width="900px" narrow="{{narrowMode}}" drawer-width="272px" disable-edge-swipe>
        <app-sidebar drawer>
          <div class="content">
            <div id="section-list">
              <nav>
                <a href="/?poly=1" is="pushstate-anchor" class="section" tabindex="1">
                  <div class="layout horizontal center">
                    <div class="all-symbol" aria-hidden="true"><iron-icon icon="apps"></iron-icon></div>
                    <span class="title flex">dashboard</span>
                  </div>
                </a>
                <template is="dom-repeat" items="[[sections]]">
                  <a class="section" href$="[[_sectionLink(item.id)]]" active$="[[_isEqual(section.id,item.id)]]" tabindex="1">
                    <div class="layout horizontal center">
                        <section-symbol aria-hidden="true" icon="[[item.icon]]" color="[[item.color]]"></section-symbol>
                        <span class="title flex">[[item.id]]</span>
                    </div>
                  </a>
                </template>
              </nav>
            </div>
          </div>
        </app-sidebar>
        <paper-header-panel id="container" mode="[[_getMode(narrowMode)]]" view$="[[_actualView(view)]]" main>
          <div class="paper-header">
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
            <h2 class="flex">Machine page</h2>
            <app-bar class="horizontal layout center end-justified" query="{{q}}"></app-bar>
            <paper-icon-button icon="icons:sort"></paper-icon-button>
            <paper-icon-button icon="account-circle"></paper-icon-button>
          </div>
          <div id="content">
            <app-graph title="CPU"></app-graph>
            <app-graph title="DISKS READ"></app-graph>
            <app-graph title="IFACES RX"></app-graph>
            <app-graph title="DISKS WRITE"></app-graph>
            <app-graph title="RAM"></app-graph>
            <app-graph title="LOAD"></app-graph>

            <app-rules></app-rules>

          </div>
        </paper-header-panel>
      </paper-drawer-panel>
      <paper-fab icon="add"></paper-fab>

  </template>
</dom-module>

<script>
    Polymer({
      is: 'page-machine',
      enableCustomStyleProperties: true,
      properties: {
        router: Object,
        pageTitle: {type: String},
        params: Object,
        sections: Array,
        section: {type: Object, notify: true, value: {}},
        elements: Array
      },
      
      _sectionLink: function(name) {
        return '/' + name;
      },
      
      ready: function() {
        this.sectionsArray = [
          {id: 'machines',
          color: '#8c76d1',
          icon: 'hardware:computer'},
          {id: 'images',
          color: '#0099cc',
          icon: 'image:photo'},
          {id: 'keys',
          color: '#009688',
          icon: 'communication:vpn-key'},
          {id: 'networks',
          color: '#795548',
          icon: 'hardware:device-hub'},
          {id: 'scripts',
          color: '#D48900',
          icon: 'image:movie-creation'}]
      },
      
      attached: function() {

      },
      
      _handleParamsUpdate: function(_, params) {
        for (var key in params) {
          this[key] = params[key];
        }
      },
      
      _isEqual: function(a,b) {
        return a === b;
      },

      _getColor: function() {
        return this.section && this.section.color ? this.section.color : '';
      },

      _getMode: function(narrow) {
        return narrow ? 'waterfall' : 'scroll';
      },

      _actualView: function(view, force) {
        return force ? 'cards' : view;
      },
    });
</script>
