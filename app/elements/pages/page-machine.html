<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="../section-symbol/section-symbol.html">
<link rel="import" href="../tag-link/tag-link.html">
<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../element-action-menu/element-action-menu.html">
<link rel="import" href="../element-table/element-table.html">
<link rel="import" href="../element-table-cards/element-table-cards.html">
<link rel="import" href="../responsive-element/responsive-element.html">

<link rel="import" href="../app-graph/app-graph.html">
<link rel="import" href="../app-rules/app-rules.html">

<dom-module id="page-machine">
  <link rel="import" type="css" href="page-machine.css">

  <template>
      <paper-drawer-panel id="drawerPanel" responsive-width="900px" narrow="{{narrowMode}}" drawer-width="272px" disable-edge-swipe>
        <app-sidebar tag="[[tag]]" sections="[[sections]]" current="[[section.id]]" drawer></app-sidebar>
        <paper-header-panel id="container" mode="[[_getMode(narrowMode)]]" view$="[[_actualView(view)]]" main>
          <div class="paper-header">
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
            <h2 class="flex"> {{machine.name}} : {{machine.state}} </h2>
            <app-bar class="horizontal layout center end-justified" query="{{q}}"></app-bar>
            <paper-icon-button icon="icons:sort"></paper-icon-button>
            <paper-icon-button icon="account-circle"></paper-icon-button>
          </div>
          <div id="content">
            <div class="machine-info">
              uuid = [[params.uuid]] <br/>
              id   = {{machine.id}} <br/>
              name = {{machine.name}} <br/>
              <paper-button on-tap="listInfo">temp machine info helper</paper-button>
              <div id="machineproperties"></div>
            </div>
            <app-graph title="CPU">
              <google-chart id="mutating_gauge0" type="line" data='[["Label", "Value"],["Memory", 80],["CPU", 55],["Network", 68]]' options='{
                "redFrom": 90,
                "redTo": 100,
                "yellowFrom": 75,
                "yellowTo": 90,
                "minorTicks": 5}'>
              </google-chart>
            </app-graph>
            <app-graph title="DISKS READ">
              <google-chart id="mutating_gauge1" type="line" data='[["Label", "Value"],["Memory", 80],["CPU", 55],["Network", 68]]' options='{
                "redFrom": 90,
                "redTo": 100,
                "yellowFrom": 75,
                "yellowTo": 90,
                "minorTicks": 5}'>
              </google-chart>
            </app-graph>
           <!--  <app-graph title="IFACES RX">
              <google-chart id="mutating_gauge2" type="line" data='[["Label", "Value"],["Memory", 80],["CPU", 55],["Network", 68]]' options='{
                "redFrom": 90,
                "redTo": 100,
                "yellowFrom": 75,
                "yellowTo": 90,
                "minorTicks": 5}'>
              </google-chart>
            </app-graph>
            <app-graph title="DISKS WRITE">
              <google-chart id="mutating_gauge3" type="line" data='[["Label", "Value"],["Memory", 80],["CPU", 55],["Network", 68]]' options='{
                "redFrom": 90,
                "redTo": 100,
                "yellowFrom": 75,
                "yellowTo": 90,
                "minorTicks": 5}'>
              </google-chart>
            </app-graph>
            <app-graph title="RAM"></app-graph>
            <app-graph title="LOAD"></app-graph> -->

            <app-rules></app-rules>

          </div>
          <div class="absolute-bottom-right">
            <paper-menu-button vertical-align="bottom" horizontal-align="right">
              <paper-fab icon="add" class="dropdown-trigger" alt="bottom align">Actions</paper-fab>
              <paper-menu class="dropdown-content">
                <paper-button on-click="addKey">Add Key</paper-button>
                <paper-button on-click="rename">Rename Machine</paper-button>
                <paper-button on-click="restart">Restart Machine</paper-button>
                <paper-button on-click="shutdown">Shutdown Machine</paper-button>
                <paper-button on-click="destroy">Destroy Machine</paper-button>
              </paper-menu>
            </paper-menu-button>
          </div>
        </paper-header-panel>
      </paper-drawer-panel>      
  </template>
</dom-module>

<script>
    window.setInterval(function() {
        var gauges = [];
        for (var i=0; i<2; i++) {
        gauges[i] = document.getElementById('mutating_gauge'+i);
        gauges[i].data = [
            ["Label", "Value"],
            ["Memory", getRandomGaugeValue(40, 60)],
            ["CPU", getRandomGaugeValue(40, 60)],
            ["Network", getRandomGaugeValue(60, 20)]
        ];
      }
    }, 3000);
    
    Polymer({
      is: 'page-machine',
      enableCustomStyleProperties: true,
      properties: {
        router: Object,
        pageTitle: {type: String},
        params: {type: Object, notify: true},
        sections: Array,
        section: {type: Object, notify: true, value: {}},
        tag: {type: String, value: ""},
        
        model: Object,
        machine: Object
      },
      listeners: {

      },
      ready: function(){

      },
      attached: function() {

      },
      listInfo: function(e) {
        console.log("ttt clicked");

        var info = '';
        for(var prop in this.machine){
          info+=prop+" : "+this.machine[prop]+", ";
        }
        this.$.machineproperties.textContent = info;        
      },
      _sectionLink: function(name) {
        return '/' + name;
      },
      _handleParamsUpdate: function(_, params) {
        for (var key in params) {
          this[key] = params[key];
        }        
      },
      _isEqual: function(a,b) {
        return a === b;
      },
      _getColor: function() {
        return this.section && this.section.color ? this.section.color : '';
      },
      _getMode: function(narrow) {
        return narrow ? 'waterfall' : 'scroll';
      },
      _actualView: function(view, force) {
        return force ? 'cards' : view;
      },
      addKey: function (_,params) {
        console.log("clicked addKey");
      },
      rename: function(_,params){
        console.log("clicked rename");
      },
      restart: function(_,params){
        console.log("clicked restart");
      },
      shutdown: function(_,params){
        console.log("clicked shutdown");
      },
      destroy: function(_,params){
        console.log("clicked destroy");
      }
    });
</script>
