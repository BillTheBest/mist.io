<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../section-symbol/section-symbol.html">
<link rel="import" href="../tag-link/tag-link.html">
<link rel="import" href="../theme-color/theme-color.html">
<link rel="import" href="../element-for-in/element-for-in.html">
<link rel="import" href="../app-rules/app-rules.html">
<link rel="import" href="../../styles/shared-styles.html">
<dom-module id="page-machine">
    <link rel="import" type="css" href="../../styles/main.css">
    <template>
        <style is="custom-style" include="tags-and-labels"></style>
        <style is="custom-style" include="info-table-style"></style>
        <style>
        :host {
            background: #fafafa;
        }

        #content {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }

        .paper-header h2 {
            @apply(--layout-flex-none);
        }

        .machine-ip {
            margin: 0;
        }

        </style>
        <paper-drawer-panel id="drawerPanel" responsive-width="900px" narrow="{{narrowMode}}" drawer-width="272px" disable-edge-swipe>
            <app-sidebar tag="[[tag]]" sections="{{sections}}" current="machines" drawer></app-sidebar>
            <paper-header-panel id="container" mode="[[_getMode(narrowMode)]]" view$="[[_actualView(view)]]" main>
                <div class="paper-header">
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <h2>Machine: {{machine.name}}</h2>
                    <div class="label flex">
                        <span class$="{{machine.state}}" title="machine state">{{machine.state}}</span>
                    </div>
                    <app-bar class="horizontal layout center end-justified" query="{{q}}"></app-bar>
                    <paper-icon-button icon="icons:sort"></paper-icon-button>
                    <app-user-menu email="marios@mist.io"></app-user-menu>
                </div>
                <div id="content">
                    <paper-material class="info-card" >
                        <h2 style$="[[_getHeaderStyle(section.color)]]">Basic Info</h2>
                        <div class="card-content">
                            <table class="info-table">
                                <template is="dom-if" if="[[machine.public_ips]]">
                                    <tr>
                                        <td>
                                            Public IPs
                                        </td>
                                        <td>
                                            <template is="dom-repeat" items="[[machine.public_ips]]">
                                                <p class="machine-ip">[[item]]</p>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                                <template is="dom-if" if="[[machine.private_ips]]">
                                    <tr>
                                        <td>
                                            Private IPs
                                        </td>
                                        <td>
                                            <template is="dom-repeat" items="[[machine.private_ips]]">
                                                <p class="machine-ip">[[item]]</p>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                                <template is="dom-if" if="[[machine.df]]">
                                    <tr>
                                        <td colspan="2">
                                            <div class="df">[[machine.df]]</div>
                                        </td>
                                    </tr>
                                </template>
                                <template is="dom-if" if="[[machine.extra.dns_name]]">
                                    <tr>
                                        <td>
                                            DNS Name
                                        </td>
                                        <td>
                                            [[machine.extra.dns_name]]
                                        </td>
                                    </tr>
                                </template>
                                <template is="dom-if" if="[[machine.extra.launchdatetime]]">
                                    <tr>
                                        <td>
                                            Launch Date
                                        </td>
                                        <td>
                                            [[machine.extra.launchdatetime]]
                                        </td>
                                    </tr>
                                </template>
                            </table>
                        </div>
                    </paper-material>
                    <paper-material class="info-card" >
                        <h2 style$="[[_getHeaderStyle(section.color)]]">Full Metadata List</h2>
                        <div class="card-content">
                            <element-for-in content="[[machine.extra]]"></element-for-in>
                        </div>
                    </paper-material>
                    <app-rules></app-rules>
                </div>
                <div class="absolute-bottom-right">
                    <app-fab></app-fab>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
</dom-module>
<script>

Polymer({
    is: 'page-machine',
    // enableCustomStyleProperties: true,
    properties: {
        router: Object,
        pageTitle: {
            type: String
        },
        params: {
            type: Object,
            notify: true
        },
        sections: {
            type: Array,
            notify: true
        },
        section: {
            type: Object
        },
        tag: {
            type: String,
            value: ""
        },
        model: Object,
        machine: Object
    },
    listeners: {
        'machine-changed': '_machineStateLabel'
    },
    listInfo: function(e) {
        var info = '';
        for (var prop in this.machine) {
            info += prop + " : " + this.machine[prop] + ", ";
        }
        this.$.machineproperties.textContent = info;
    },
    _machineStateLabel: function() {
        Polymer.dom('machine-state').setAttr('class', this.machine.state);
    },
    _sectionLink: function(name) {
        return '/' + name;
    },
    _handleParamsUpdate: function(_, params) {
        for (var key in params) {
            this[key] = params[key];
        }
    },
    _isEqual: function(a, b) {
        return a === b;
    },
    _getColor: function() {
        return this.section && this.section.color ? this.section.color : '';
    },
    _getMode: function(narrow) {
        return narrow ? 'waterfall' : 'scroll';
    },
    _actualView: function(view, force) {
        return force ? 'cards' : view;
    },
    addKey: function(_, params) {
        console.log("clicked addKey");
    },
    rename: function(_, params) {
        console.log("clicked rename");
    },
    restart: function(_, params) {
        console.log("clicked restart");
    },
    shutdown: function(_, params) {
        console.log("clicked shutdown");
    },
    destroy: function(_, params) {
        console.log("clicked destroy");
    },
    _getHeaderStyle: function(color) {
        return 'background-color: ' + color + '; color: #fff;';
    },
});
</script>
