<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../element-action-menu/element-action-menu.html">
<link rel="import" href="../app-image-icons/app-image-icons.html">
<link rel="import" href="../tag-link/tag-link.html">
<dom-module id="machine-list-item">
    <template>
        <style is="custom-style" include="tags-and-labels"></style>
        <style>
        :host {
            @apply(--layout-horizontal);
            padding: 15px 24px;
            width: 100%;
        }

        :host(:not([narrow-viewport])) a {
            @apply(--layout-horizontal);
            padding: 6px 0px 6px 0;
        }

        :host([narrow-viewport]) a {
            @apply(--layout-vertical);
            padding: 0;
        }

        #check {
            padding-right: 24px;
        }

        /* name id provider state tags */
        .field.field0 {
            width: 250px;
            font-weight: 500;
            text-overflow: ellipsis;
        }

        .field {
            width: 150px;
            font-weight: 400;
            overflow: scroll;
            margin-right: 24px;
        }

        .field.tags {
            width: auto;
        }

        .id {
            color: #757575;
        }

        :host([narrow-viewport]) .name,
        :host([narrow-viewport]) .cloud,
        :host([narrow-viewport]) .state,
        :host([narrow-viewport]) .tags {
            width: auto;
        }

        :host([narrow-viewport]) .field3,
        :host([medium-viewport]) .field4 {
            display: none;
        }
        </style>
        <iron-media-query query="(max-width: 640px)" query-matches="{{narrowViewport}}"></iron-media-query>
        <iron-media-query query="(min-width: 641px) and (max-width: 1300px)" query-matches="{{mediumViewport}}"></iron-media-query>
        <content></content>
        <a href$="[[itemLink]]" is="pushstate-anchor" ondragstart="return false;" ondrop="return false;">

            <template is="dom-repeat" items="{{fields}}" as="field">
              <a href$="[[itemLink]]" is="pushstate-anchor" ondragstart="return false;" ondrop="return false;">
                <div class$="[[field]] field field[[index]]">{{itemField(item, field)}}</div>
              </a>
            </template>
            <div class="field tags" hidden$="[[!item.tags.length]]">
                <template is="dom-if" if="[[item.tags.length]]">
                    <template is="dom-repeat" items="{{_itemTagsArray(item.tags)}}">
                        <span class="tag">
                            <template is="dom-if" if="[[item.key]]">[[item.key]]=</template>[[item.value]]
                        </span>
                    </template>
                </template>
            </div>
            </a>
    </template>
</dom-module>
<script>
Polymer({
    is: 'machine-list-item',
    properties: {
        // tags: {
        //   type: Array
        // },
        actions: {
            type: Array,
        },
        fields: {
            type: Array,
        },
        selected: {
            type: Boolean
        },
        allselected: {
            type: Boolean,
            notify: true
        },
        item: {
            type: Object
        },
        section: {
            type: Object
        },
        itemLink: {
            type: String,
            computed: "_itemLink(section,item)"
        },
        narrowViewport: {
            type: Boolean,
            reflectToAttribute: true
        }
    },

    itemField: function(item, field) {
        var ret = item[field];
        if (ret && ret.title)
            return ret.title;
        else if (!ret && item.extra && item.extra[field])
            return item.extra[field];
        else if (!ret && item.extra && item.extra[field+'_id'])
            return item.extra[field+'_id'];
        else
            return ret;
    },
    machineActions: function(item) {
        var actions = ['destroy'];
        if (item.state == 'running')
          actions.push('stop');
        if (item.state == 'stopped')
          actions.push('start');
        return actions;
    },

    _itemLink: function(section, item) {
        return "/" + section.id + "/" + item.uuid;
    },

    _itemTagsArray: function(tagsobject) {
        var tagsArray = [];
        if (tagsobject.length > 0) {
            for (i = 0; i < tagsobject.length; i++) {
                tagsArray.unshift(tagsobject[i]);
            }
        }
        return tagsArray;
    },

    _firstItem: function (index) {
        return !index;
    }
});
</script>
